name: update-dev
on:
  workflow_run:
    workflows:
      - Build Website
    types:
      - completed
    branches:
      - master
  schedule:
    - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  update-dev:
    runs-on: ubuntu-latest

    # If the job is triggered by a workflow_run, only run if the source workflow was triggered by a push to master
    if: >-
      ${{
        github.event_name != 'workflow_run' ||
        (
          github.event_name == 'workflow_run' &&
          github.event.workflow_run.conclusion == 'success' &&
          github.event.workflow_run.event == 'push'
        )
      }}

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Nightly Merge
        uses: robotology/gh-action-nightly-merge@v1.3.3
        with:
          stable_branch: 'master'
          development_branch: 'dev'
          allow_ff: false
        env:
          GITHUB_TOKEN: ${{ secrets.NIGHTLY_TOKEN }}
