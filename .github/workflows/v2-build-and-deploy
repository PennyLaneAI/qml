name: V2 Build and Deploy Demos

on:
  workflow_dispatch:
    inputs:
      environment:
        description: SWC environment to deploy to
        options:
          - swc-staging
          - swc-prod
          - swc-dev
        required: true
        type: choice
      branch:
        default: master
        description: Branch to build demos against `master` (stable) or `dev` (latest)
        options:
          - master
          - dev
        required: true
        type: choice
      demos:
        description: Demos to build and deploy, if all demos are to be built leave blank
        required: false
        type: string
      as-previews:
        default: false
        description: Whether to deploy demos as preview
        required: true
        type: boolean


jobs:
  build:
    uses: ./.github/workflows/v2-build-demos.yml
    with:
      ref: ${{ github.event.inputs.branch }}
      demo-names: ${{ github.event.inputs.demos }}
      dev: ${{ github.event.inputs.branch == 'dev' }}
      save-artifact: true
      artifact-name: build-and-deploy-${{ github.event.inputs.branch }}
      keep-going: false
      quiet: false
      batch_size: 10

  deploy:
    uses: ./.github/workflows/v2-deploy-demos.yml
    with:
      environment: ${{ github.event.inputs.environment }}
      artifact-name: build-and-deploy-${{ github.event.inputs.branch }}
      preview: ${{ github.event.inputs.as-previews }}
      branch: ${{ github.event.inputs.branch }}
    secrets: inherit
